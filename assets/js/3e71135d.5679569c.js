"use strict";(globalThis.webpackChunkgodseye=globalThis.webpackChunkgodseye||[]).push([[4140],{1480(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"systems/authentication","title":"\ud83d\udd10 Authentication & Identity System","description":"GodsEye identity layer: multi-cloud active-active Keycloak federation. Four identity types, RBAC hierarchy, offline-capable POS auth. Zero-trust architecture throughout.","source":"@site/docs/systems/authentication.md","sourceDirName":"systems","slug":"/systems/authentication","permalink":"/godseye/systems/authentication","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"\ud83d\udd10 Authentication & Identity System"},"sidebar":"architectureSidebar","previous":{"title":"\ud83d\udecd\ufe0f Customer Experience Layer","permalink":"/godseye/architecture/customer-experience"},"next":{"title":"\ud83d\udcb3 Payment Gateway Orchestrator","permalink":"/godseye/systems/payments"}}');var i=t(4848),s=t(8453);const a={sidebar_position:1,sidebar_label:"\ud83d\udd10 Authentication & Identity System"},d="\ud83d\udd10 Authentication & Identity System",o={},c=[{value:"Identity Architecture",id:"identity-architecture",level:2},{value:"Multi-Cloud Auth Resilience",id:"multi-cloud-auth-resilience",level:2},{value:"Auth Flow - Customer",id:"auth-flow---customer",level:2},{value:"Auth Flow - POS Offline",id:"auth-flow---pos-offline",level:2},{value:"RBAC Model",id:"rbac-model",level:2},{value:"Build vs Buy Strategy",id:"build-vs-buy-strategy",level:2},{value:"Token Lifecycle",id:"token-lifecycle",level:2}];function l(e){const n={h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-authentication--identity-system",children:"\ud83d\udd10 Authentication & Identity System"})}),"\n",(0,i.jsx)(n.p,{children:"GodsEye identity layer: multi-cloud active-active Keycloak federation. Four identity types, RBAC hierarchy, offline-capable POS auth. Zero-trust architecture throughout."}),"\n",(0,i.jsx)(n.h2,{id:"identity-architecture",children:"Identity Architecture"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TD\n    KC["Keycloak Federation Cluster<br/>(Active-Active, Multi-Cloud)"]\n\n    subgraph CID["Customer Identity"]\n        C1["Email / Password<br/>(Argon2id hashing)"]\n        C2["Social Login<br/>(Google, Apple, Facebook)"]\n        C3["Passkeys / WebAuthn<br/>(FIDO2)"]\n        C4["Guest Checkout<br/>(ephemeral session)"]\n        C5["Progressive Profiling<br/>(enrich over time)"]\n    end\n\n    subgraph EID["Employee Identity"]\n        E1["SSO via SAML 2.0 / OIDC"]\n        E2["Role: Store Associate"]\n        E3["Role: Store Manager"]\n        E4["Role: Buyer / Merchandiser"]\n        E5["Role: Executive"]\n        E6["Role: Engineer"]\n        E7["Store-Level Permissions<br/>(tenant + location scoped)"]\n    end\n\n    subgraph AID["API Identity"]\n        A1["OAuth 2.0<br/>(client_credentials + auth_code)"]\n        A2["mTLS<br/>(service-to-service)"]\n        A3["JWT Access Token<br/>(short-lived, 15 min)"]\n        A4["JWT Refresh Token<br/>(long-lived, 7 days)"]\n    end\n\n    subgraph DID["Device Identity"]\n        D1["POS Terminal Attestation<br/>(hardware TPM)"]\n        D2["Mobile Device Fingerprint<br/>(SDK-based)"]\n        D3["IoT Sensors<br/>(X.509 cert per device)"]\n    end\n\n    CID --\x3e KC\n    EID --\x3e KC\n    AID --\x3e KC\n    DID --\x3e KC\n\n    KC --\x3e TS["Token Store<br/>(Redis Cluster)"]\n    KC --\x3e UK["User Directory<br/>(PostgreSQL + LDAP sync)"]\n    KC --\x3e AL["Audit Log<br/>(immutable, append-only)"]'}),"\n",(0,i.jsx)(n.h2,{id:"multi-cloud-auth-resilience",children:"Multi-Cloud Auth Resilience"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph LR\n    subgraph AWS["AWS (us-east-1)"]\n        KC_AWS["Keycloak Cluster<br/>3 nodes"]\n        R_AWS["Redis Token Cache<br/>(ElastiCache)"]\n        KC_AWS <--\x3e R_AWS\n    end\n\n    subgraph GCP["GCP (us-central1)"]\n        KC_GCP["Keycloak Cluster<br/>3 nodes"]\n        R_GCP["Redis Token Cache<br/>(Memorystore)"]\n        KC_GCP <--\x3e R_GCP\n    end\n\n    subgraph AZ["Azure (East US)"]\n        KC_AZ["Keycloak Cluster<br/>3 nodes"]\n        R_AZ["Redis Token Cache<br/>(Azure Cache)"]\n        KC_AZ <--\x3e R_AZ\n    end\n\n    SK["Shared Signing Keys<br/>(HSM-backed, replicated<br/>via Vault Transit)"]\n\n    KC_AWS <--\x3e|"JDBC replication<br/>+ Infinispan"| KC_GCP\n    KC_GCP <--\x3e|"JDBC replication<br/>+ Infinispan"| KC_AZ\n    KC_AWS <--\x3e|"JDBC replication<br/>+ Infinispan"| KC_AZ\n\n    SK --\x3e KC_AWS\n    SK --\x3e KC_GCP\n    SK --\x3e KC_AZ\n\n    subgraph FAILOVER["Failure Scenarios"]\n        F1["AWS down --\x3e GCP + Azure<br/>validate all tokens"]\n        F2["ALL auth clusters down --\x3e<br/>cached tokens valid 4 hours"]\n        F3["POS offline --\x3e local credential<br/>cache valid 72 hours"]\n    end'}),"\n",(0,i.jsx)(n.h2,{id:"auth-flow---customer",children:"Auth Flow - Customer"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as Customer Browser\n    participant CDN as CDN Edge<br/>(CloudFlare)\n    participant APP as Application Server\n    participant KC as Keycloak Cluster\n    participant R as Redis Token Cache\n\n    C->>CDN: GET /dashboard\n    CDN->>CDN: Check session cookie\n\n    alt Valid JWT in cookie\n        CDN->>CDN: Validate JWT signature<br/>(public key cached at edge)\n        CDN->>APP: Forward request<br/>(JWT validated, no DB hit)\n        APP->>C: Serve page\n    else Expired or missing JWT\n        CDN->>C: 302 Redirect to /auth/login\n        C->>KC: POST /auth (email + password)\n        KC->>KC: Validate credentials<br/>(Argon2id hash check)\n        KC->>KC: Check MFA requirement\n        KC->>R: Store session metadata\n        KC->>C: Issue JWT pair<br/>(access: 15min, refresh: 7d)\n        Note over KC,C: Tokens set as HTTP-only,<br/>Secure, SameSite=Strict cookies\n        C->>CDN: GET /dashboard (with JWT cookie)\n        CDN->>CDN: Validate JWT at edge<br/>(no DB hit)\n        CDN->>APP: Forward authenticated request\n        APP->>C: Serve page\n    end\n\n    Note over C,R: Refresh Flow\n    C->>CDN: GET /api/data (expired access token)\n    CDN->>C: 401 Token Expired\n    C->>KC: POST /auth/refresh (refresh token)\n    KC->>R: Validate refresh token not revoked\n    KC->>C: New JWT pair (rotate both tokens)\n    C->>CDN: Retry original request"}),"\n",(0,i.jsx)(n.h2,{id:"auth-flow---pos-offline",children:"Auth Flow - POS Offline"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant EMP as Employee Badge\n    participant POS as POS Terminal\n    participant LC as Local Auth Cache<br/>(SQLite + encrypted)\n    participant NET as Network Monitor\n    participant KC as Keycloak API\n    participant SYNC as Sync Service\n\n    Note over EMP,KC: Normal Operation (Online)\n    EMP->>POS: Tap employee badge\n    POS->>KC: POST /auth/employee<br/>(badge ID + terminal attestation)\n    KC->>KC: Validate badge + role + store\n    KC->>POS: JWT (access: 8hr shift, refresh: 24hr)\n    POS->>LC: Cache credentials + token locally<br/>(AES-256 encrypted)\n    POS->>POS: Employee logged in, POS active\n\n    Note over EMP,KC: Offline Operation\n    NET->>POS: Connectivity loss detected\n    POS->>POS: Switch to OFFLINE mode<br/>(visual indicator on screen)\n\n    EMP->>POS: Tap employee badge (shift change)\n    POS->>LC: Validate badge against local cache\n    LC->>POS: Cached credential valid<br/>(within 72-hour window)\n    POS->>POS: Employee logged in (offline)\n    POS->>POS: Process transactions<br/>(queue locally, signed with device key)\n\n    Note over EMP,KC: Reconnection\n    NET->>POS: Internet restored\n    POS->>SYNC: Sync queued transactions<br/>(ordered, deduplicated)\n    SYNC->>KC: Re-authenticate all sessions\n    KC->>POS: Fresh tokens issued\n    POS->>LC: Refresh local auth cache\n    POS->>POS: Resume ONLINE mode"}),"\n",(0,i.jsx)(n.h2,{id:"rbac-model",children:"RBAC Model"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TD\n    PA["Platform Admin<br/>(GodsEye Engineering)"]\n    TA["Tenant Admin<br/>(Retailer HQ)"]\n    SM["Store Manager"]\n    DM["Department Manager"]\n    SA["Store Associate"]\n\n    PA --\x3e TA\n    TA --\x3e SM\n    SM --\x3e DM\n    DM --\x3e SA\n\n    subgraph PERMS["Permission Matrix"]\n        P1["POS Access"]\n        P2["Price Override"]\n        P3["Void Transaction"]\n        P4["View Reports"]\n        P5["Manage Inventory"]\n        P6["Manage Employees"]\n        P7["Configure Store Settings"]\n        P8["Manage Integrations"]\n        P9["View Financials"]\n        P10["Platform Configuration"]\n    end\n\n    SA -.->|"granted"| P1\n    DM -.->|"granted"| P1\n    DM -.->|"granted"| P2\n    DM -.->|"granted"| P5\n    SM -.->|"granted"| P1\n    SM -.->|"granted"| P2\n    SM -.->|"granted"| P3\n    SM -.->|"granted"| P4\n    SM -.->|"granted"| P5\n    SM -.->|"granted"| P6\n    TA -.->|"granted"| P4\n    TA -.->|"granted"| P6\n    TA -.->|"granted"| P7\n    TA -.->|"granted"| P8\n    TA -.->|"granted"| P9\n    PA -.->|"granted"| P10\n    PA -.->|"granted"| P8'}),"\n",(0,i.jsx)(n.h2,{id:"build-vs-buy-strategy",children:"Build vs Buy Strategy"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Phase 1 (Launch)"}),(0,i.jsx)(n.th,{children:"Phase 2 (Scale)"}),(0,i.jsx)(n.th,{children:"Phase 3 (Own)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Identity Provider"})}),(0,i.jsx)(n.td,{children:"Auth0 managed"}),(0,i.jsx)(n.td,{children:"Keycloak on K8s (managed DB)"}),(0,i.jsx)(n.td,{children:"Own Keycloak clusters, multi-cloud"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Token Store"})}),(0,i.jsx)(n.td,{children:"Auth0 built-in"}),(0,i.jsx)(n.td,{children:"Redis ElastiCache"}),(0,i.jsx)(n.td,{children:"Multi-cloud Redis federation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"MFA"})}),(0,i.jsx)(n.td,{children:"Auth0 Guardian"}),(0,i.jsx)(n.td,{children:"Auth0 + custom TOTP"}),(0,i.jsx)(n.td,{children:"Own MFA service (WebAuthn focus)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"User Directory"})}),(0,i.jsx)(n.td,{children:"Auth0 DB"}),(0,i.jsx)(n.td,{children:"PostgreSQL + LDAP bridge"}),(0,i.jsx)(n.td,{children:"Distributed PostgreSQL (CockroachDB)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Social Login"})}),(0,i.jsx)(n.td,{children:"Auth0 connectors"}),(0,i.jsx)(n.td,{children:"Auth0 connectors"}),(0,i.jsx)(n.td,{children:"Direct OIDC integration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Device Attestation"})}),(0,i.jsx)(n.td,{children:"N/A"}),(0,i.jsx)(n.td,{children:"Third-party SDK"}),(0,i.jsx)(n.td,{children:"Own attestation service"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"token-lifecycle",children:"Token Lifecycle"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Token Type"}),(0,i.jsx)(n.th,{children:"TTL"}),(0,i.jsx)(n.th,{children:"Refresh Policy"}),(0,i.jsx)(n.th,{children:"Revocation Strategy"}),(0,i.jsx)(n.th,{children:"Storage"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Customer Access JWT"})}),(0,i.jsx)(n.td,{children:"15 minutes"}),(0,i.jsx)(n.td,{children:"Silent refresh via refresh token"}),(0,i.jsx)(n.td,{children:"Revocation list in Redis (check at edge)"}),(0,i.jsx)(n.td,{children:"HTTP-only cookie"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Customer Refresh Token"})}),(0,i.jsx)(n.td,{children:"7 days"}),(0,i.jsx)(n.td,{children:"Rotate on each use (one-time use)"}),(0,i.jsx)(n.td,{children:"Immediate revocation on logout/password change"}),(0,i.jsx)(n.td,{children:"HTTP-only cookie"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Employee Access JWT"})}),(0,i.jsx)(n.td,{children:"8 hours (shift)"}),(0,i.jsx)(n.td,{children:"Manual refresh at shift change"}),(0,i.jsx)(n.td,{children:"Revoked on clock-out or termination"}),(0,i.jsx)(n.td,{children:"POS local store + cookie"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Employee Offline Cache"})}),(0,i.jsx)(n.td,{children:"72 hours"}),(0,i.jsx)(n.td,{children:"Refreshed on reconnection"}),(0,i.jsx)(n.td,{children:"Purged on reconnection or expiry"}),(0,i.jsx)(n.td,{children:"POS SQLite (AES-256)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"API Client Token"})}),(0,i.jsx)(n.td,{children:"1 hour"}),(0,i.jsx)(n.td,{children:"client_credentials re-grant"}),(0,i.jsx)(n.td,{children:"Client secret rotation, scope reduction"}),(0,i.jsx)(n.td,{children:"In-memory only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Service Mesh mTLS"})}),(0,i.jsx)(n.td,{children:"24 hours"}),(0,i.jsx)(n.td,{children:"Auto-rotated by Istio/SPIFFE"}),(0,i.jsx)(n.td,{children:"Certificate revocation via CRL"}),(0,i.jsx)(n.td,{children:"Envoy sidecar"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Device Certificate"})}),(0,i.jsx)(n.td,{children:"90 days"}),(0,i.jsx)(n.td,{children:"Auto-renewed 7 days before expiry"}),(0,i.jsx)(n.td,{children:"Remote wipe triggers cert revocation"}),(0,i.jsx)(n.td,{children:"Device TPM/Secure Enclave"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>d});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);